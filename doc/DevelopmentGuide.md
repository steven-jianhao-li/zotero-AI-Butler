## å¸¸ç”¨å‘½ä»¤

- å‘å¸ƒæ–°ç‰ˆæœ¬ï¼š`npm run release`
- æ‰“åŒ…æ’ä»¶ï¼š`npm run build`
- æœ¬åœ°æµ‹è¯•ï¼š`npm start`
- ä¿®æ”¹zotero profileï¼š `./zotero.exe -p`(åœ¨Windows zoteroå®‰è£…ç›®å½•ä¸‹è¿è¡Œ)
- ç»Ÿä¸€ä»£ç æ ¼å¼ï¼š`npx prettier --write .`
- æ£€æŸ¥ä»£ç æ ¼å¼ï¼š`npm run lint:check`

# zotero-AI-Butler

> **æ–‡çŒ®ä¸‹è½½ä¸€æ—¶çˆ½ï¼Œæ‰“å¼€é˜…è¯»ç«è‘¬åœºã€‚**
> **å¤©ä¹¦éš¾å•ƒéª¨å¤´ç¡¬ï¼Œç®¡å®¶åš¼ç¢å†å–‚ç²®ã€‚**

æƒ³ç€ç¨åé˜…è¯»çš„è®ºæ–‡ï¼Œæœ€åå´å˜æˆäº†æ°¸ä¸é˜…è¯»ï¼Ÿ
é•¿ç¯‡å¤§è®ºçš„å­¦æœ¯è®ºæ–‡ï¼Œæœ‰ç¿»è¯‘å´ä¹ŸæŠ“ä¸ä½é‡ç‚¹ï¼Ÿ

ä½ æ˜¯å¦ä¹Ÿè¢«ä»¥ä¸‹é—®é¢˜å›°æ‰°ï¼Ÿ

- ç—›ç‚¹ä¸€ï¼šæ–‡ç« å¤ªå¤šï¼Œè¯»ä¸è¿‡æ¥ã€‚å³ä¾¿è®©AIè¾…åŠ©é˜…è¯»ï¼Œå´è¿˜è¦ä¸€ç¯‡ä¸€ç¯‡çš„å‘ç»™AIï¼Œæ•ˆç‡ä½ä¸‹ã€‚
- ç—›ç‚¹äºŒï¼šè¯»å®Œå°±å¿˜ï¼Œéœ€è¦åå¤é‡æ–°é˜…è¯»ã€‚ è¾›è¾›è‹¦è‹¦è¯»å®Œä¸€ç¯‡ï¼Œä¸¤å¤©åå°±å¿˜äº†ï¼Œæƒ³å›å¿†åˆå¾—ä»å¤´çœ‹èµ·ï¼Œæµªè´¹æ—¶é—´ã€‚
- ç—›ç‚¹ä¸‰ï¼šæ–‡ç« å¤ªé•¿ï¼Œå³ä½¿æœ‰ç¿»è¯‘æ’ä»¶ï¼Œä¹Ÿéš¾ä»¥æŠ“ä½é‡ç‚¹ï¼Œè¯»ä¸‹ä¸€é¡µå¿˜ä¸Šä¸€é¡µã€‚

åˆ«æ…Œï¼æ‚¨çš„ä¸“å±AIç®¡å®¶ `Zotero-AI-Butler` å·²é—ªäº®ç™»åœºï¼

TA æ˜¯æ‚¨7x24å°æ—¶å¾…å‘½ã€ä¸çŸ¥ç–²å€¦ä¸”ç»å¯¹å¿ è¯šçš„ç§äººç®¡å®¶ã€‚
æ‚¨åªç®¡åƒå¾€å¸¸ä¸€æ ·æŠŠæ–‡çŒ®ä¸¢è¿› Zoteroï¼Œå‰©ä¸‹çš„ä½“åŠ›æ´»å…¨äº¤ç»™TAï¼
ç®¡å®¶ä¼šè‡ªåŠ¨å¸®æ‚¨ç²¾è¯»è®ºæ–‡ï¼Œå°†æ–‡ç« æ‰ç¢äº†æ€»ç»“ä¸ºç¬”è®°ï¼Œè®©æ‚¨â€œååˆ†é’Ÿå®Œå…¨äº†è§£â€è¿™ç¯‡è®ºæ–‡ï¼

**æ ¸å¿ƒåŠŸèƒ½ï¼š**

1.  **è‡ªåŠ¨å·¡è§† (è‡ªåŠ¨æ‰«æ)**ï¼šç®¡å®¶ä¼šåœ¨åå°é»˜é»˜å·¡è§†æ‚¨çš„æ–‡çŒ®åº“ï¼Œä¸€æ—¦å‘ç°æ‚¨â€œä¸¢â€è¿›æ¥äº†æ–°è®ºæ–‡ï¼ˆæˆ–æ˜¯æ‚¨æƒ³å¯¹ç§¯å‹å·²ä¹…çš„æ—§è®ºæ–‡å¼€åˆ€ï¼‰ï¼Œåªè¦è¿˜æ²¡æœ‰ç¬”è®°ï¼ŒTA å°±ä¼šè‡ªåŠ¨å¼€å·¥ã€‚
2.  **æ·±åº¦è§£æ (ç”Ÿæˆç¬”è®°)**ï¼šç®¡å®¶çš„æ ¸å¿ƒä»»åŠ¡â€”â€”åˆ©ç”¨å¤§æ¨¡å‹å°†è®ºæ–‡ç²¾è¯»ã€æ‰ç¢ã€åš¼çƒ‚åï¼Œæ•´ç†æˆä¸€ä»½çƒ­è…¾è…¾ã€æ¡ç†æ¸…æ™°çš„ Markdown ç¬”è®°å¡è¿›æ‚¨çš„ Zotero æ¡ç›®ä¸‹ã€‚
3.  **éšæ—¶å¾…å‘½ (å³é”®èœå•)**ï¼šé™¤äº†â€œå…¨è‡ªåŠ¨â€æ‰˜ç®¡ï¼Œæ‚¨ä¹Ÿå¯ä»¥éšæ—¶å³é”®ç‚¹å‡»ä»»ä½•ä¸€ç¯‡è®ºæ–‡ï¼Œè®©ç®¡å®¶ç°åœ¨ã€ç«‹åˆ»ã€æœ€é«˜ä¼˜å…ˆçº§åœ°åˆ†æè¿™ç¯‡æ–‡ç« ã€‚
4.  **ç®¡å®¶æ™ºèƒ½ï¼ˆæ— æŸé˜…è¯»ï¼‰**ï¼šç®¡å®¶ä¼šæ ¹æ®è‡ªå·±æ¨¡å‹çš„å¤šæ¨¡æ€èƒ½åŠ›ç›´æ¥å¤„ç†PDFæ–‡ä»¶ï¼Œä¸ç»è¿‡æœ¬åœ°OCRæˆ–æ–‡æœ¬æå–ï¼Œæœ€å¤§ç¨‹åº¦ä¿ç•™è®ºæ–‡å†…å®¹çš„å®Œæ•´æ€§å’Œå‡†ç¡®æ€§ï¼Œå›¾ç‰‡ã€è¡¨æ ¼ã€å…¬å¼ç­‰éƒ½ä¸åœ¨è¯ä¸‹ï¼

æ¨èä½¿ç”¨ Google Gemini 2.5 pro æ¨¡å‹ï¼ŒGeminiè¯»è®ºæ–‡è®²çš„å¾ˆåˆ°ä½ã€‚

> **æ‚¨åªè´Ÿè´£æ€è€ƒï¼Œ`Zotero-AI-Butler` è´Ÿè´£ä¸ºæ‚¨çš„é˜…è¯»æ‰«æ¸…éšœç¢ï¼**

## æ ¸å¿ƒåŠŸèƒ½åˆ—è¡¨

1.  **è‡ªåŠ¨åŒ–ç¬”è®°ç”Ÿæˆå·¥ä½œæµ**
    - **è‡ªåŠ¨æ‰«æ**:æ’ä»¶ä¼šç›‘å¬Zoteroçš„æ¡ç›®æ·»åŠ äº‹ä»¶,è‡ªåŠ¨ä¸ºæ–°æ·»åŠ çš„è®ºæ–‡æ¡ç›®(PDFé™„ä»¶)è¿›è¡Œå¤„ç†ã€‚
    - **æ‰‹åŠ¨è§¦å‘**:åœ¨æ’ä»¶çš„ä»ªè¡¨ç›˜ç•Œé¢èƒ½å¤Ÿå¯¹ç”¨æˆ·åº“ä¸­çš„æ‰€æœ‰è®ºæ–‡è¿›è¡Œæ‰«æ,åœ¨ç”¨æˆ·ç­›é€‰å,å°†æœªå¤„ç†çš„è®ºæ–‡åŠ å…¥åˆ†æé˜Ÿåˆ—ã€‚
    - **çŠ¶æ€åˆ¤æ–­**:é€šè¿‡æ£€æŸ¥æ¡ç›®æ˜¯å¦å·²é™„åŠ ç¬¦åˆç‰¹å®šå‘½åè§„åˆ™(ä¾‹å¦‚åŒ…å«æ’ä»¶æ ‡è¯†å)çš„ç¬”è®°,æ¥åˆ¤æ–­è¯¥è®ºæ–‡æ˜¯å¦å·²è¢«å¤„ç†ã€‚
    - **è·³è¿‡å·²å¤„ç†**:å¦‚æœç¬”è®°å·²å­˜åœ¨,åˆ™è·³è¿‡è¯¥è®ºæ–‡,é¿å…é‡å¤å·¥ä½œã€‚
    - **æ‰§è¡Œåˆ†æ**:å¦‚æœç¬”è®°ä¸å­˜åœ¨,åˆ™è‡ªåŠ¨å°†è¯¥è®ºæ–‡åŠ å…¥å¤„ç†é˜Ÿåˆ—ã€‚

2.  **é›†æˆå¤§å‹è¯­è¨€æ¨¡å‹(LLM)åˆ†æ**
    - **è°ƒç”¨API**:æå–è®ºæ–‡PDFçš„æ–‡æœ¬å†…å®¹,ä¸ç”¨æˆ·é¢„è®¾çš„æç¤ºè¯(Prompt)ç»“åˆ,å‘é€ç»™æŒ‡å®šçš„å¤§æ¨¡å‹APIã€‚
    - **ä¿å­˜ç»“æœ**:å°†å¤§æ¨¡å‹è¿”å›çš„åˆ†æç»“æœ(Markdownæ ¼å¼)è‡ªåŠ¨ä¿å­˜ä¸ºè¯¥è®ºæ–‡æ¡ç›®ä¸‹çš„ä¸€ä¸ªæ–°ç¬”è®°ã€‚
    - **ç¬”è®°æ ‡è¯†**:ç”Ÿæˆçš„ç¬”è®°æ ‡é¢˜å°†åŒ…å«ç‰¹å®šçš„æ’ä»¶æ ‡è¯†å(ä¾‹å¦‚ `[AI-Butler] è®ºæ–‡æ ‡é¢˜`),ç”¨äºåŠŸèƒ½1çš„çŠ¶æ€åˆ¤æ–­ã€‚

3.  **çµæ´»çš„æ’ä»¶é…ç½®ä¸­å¿ƒ**
    - **APIé…ç½®**:
      - æ”¯æŒGoogle Geminiå¤§æ¨¡å‹ã€‚
      - æ”¯æŒAnthropic Claudeå¤§æ¨¡å‹ã€‚
      - æ”¯æŒOpenAIåŠå…¼å®¹æ¥å£ã€‚
      - æ”¯æŒè®¾ç½®è‡ªå®šä¹‰APIç«¯ç‚¹(URL),ä»¥å…¼å®¹å„ç±»æœ¬åœ°éƒ¨ç½²æˆ–ç¬¬ä¸‰æ–¹æ¨¡å‹æœåŠ¡ã€‚
    - **æç¤ºè¯é…ç½®**:
      - æä¾›é»˜è®¤çš„åˆ†ææç¤ºè¯(Prompt)ã€‚
      - å…è®¸ç”¨æˆ·å®Œå…¨è‡ªå®šä¹‰é¢„è®¾çš„æç¤ºè¯å†…å®¹ã€‚
    - **è°ƒåº¦é…ç½®**:
      - å¯è®¾ç½®è‡ªåŠ¨æ‰«æçš„æ—¶é—´é—´éš”(ä¾‹å¦‚:æ¯ 5 åˆ†é’Ÿåˆ·æ–°ä¸€æ¬¡)ã€‚
      - å¯è®¾ç½®æ¯æ‰¹æ¬¡å¤„ç†çš„è®ºæ–‡æ•°é‡(é»˜è®¤ä¸º1ç¯‡)ã€‚
      - å¯è®¾ç½®æ¯æ‰¹æ¬¡ä¹‹é—´çš„æ‰§è¡Œé—´éš”æ—¶é—´(ä¾‹å¦‚:æ¯æ‰¹é—´éš”60ç§’),ç”¨äºAPIé™æµã€‚

4.  **å³æ—¶å¤„ç†(æ‰‹åŠ¨è§¦å‘)**
    - **å³é”®èœå•**:åœ¨Zoteroæ¡ç›®åˆ—è¡¨(ä¸­æ )å’ŒPDFé™„ä»¶ä¸Šæä¾›å³é”®å¿«æ·èœå•ã€‚
    - **ç«‹å³åˆ†æ**:ç”¨æˆ·å¯é€‰ä¸­ä¸€ç¯‡æˆ–å¤šç¯‡è®ºæ–‡,é€šè¿‡å³é”®èœå•ç«‹å³å°†å…¶åŠ å…¥å¤„ç†é˜Ÿåˆ—,æ— éœ€ç­‰å¾…åå°è‡ªåŠ¨æ‰«æã€‚

5.  **PDFæ–‡ä»¶è§£æ**
    - **äº¤ç”±å¤šæ¨¡æ€å¤§æ¨¡å‹å¤„ç†**:å°†PDFæ–‡ä»¶è½¬æ¢ä¸º Base64 ç¼–ç å­—ç¬¦ä¸²,ç›´æ¥å‘é€ç»™æ”¯æŒå¤šæ¨¡æ€è¾“å…¥çš„å¤§æ¨¡å‹APIè¿›è¡Œå¤„ç†ã€‚
    - **ä»¥Geminiä¸ºä¾‹**:PDF æ–‡ä»¶çš„ Base64 å­—ç¬¦ä¸²è¢«æ”¾ç½®åœ¨ `contents.parts.inlineData.data` å­—æ®µä¸­,å¹¶é™„ä¸Šå…¶ `mimeType` ä¸º `application/pdf`ã€‚

6.  **ä»»åŠ¡é˜Ÿåˆ—ä¸çŠ¶æ€åé¦ˆ**
    - **å¤„ç†é˜Ÿåˆ—**:æ‰€æœ‰å¾…åˆ†æçš„è®ºæ–‡(æ— è®ºæ˜¯è‡ªåŠ¨æ‰«æè¿˜æ˜¯æ‰‹åŠ¨è§¦å‘)éƒ½å°†è¿›å…¥ä¸€ä¸ªç»Ÿä¸€çš„"å¾…å¤„ç†"é˜Ÿåˆ—ã€‚
    - **çŠ¶æ€æ˜¾ç¤º**:åœ¨Zoteroæ¡ç›®åˆ—è¡¨ä¸­å¢åŠ ä¸€ä¸ªè‡ªå®šä¹‰åˆ—("AIç®¡å®¶æ­£åœ¨åºŸå¯å¿˜é£Ÿåœ°å·¥ä½œğŸ§"/"AIç®¡å®¶æ­£åœ¨ä¼‘æ¯ğŸ˜´"),æ˜¾ç¤ºå½“å‰å·¥ä½œçŠ¶æ€(å·¥ä½œæ¨¡å¼,ç®¡å®¶æ­£åœ¨é˜…è¯» X ç¯‡æ–‡çŒ®,è¿˜å‰© Y ç¯‡æ–‡çŒ®)/å†å²å·¥ä½œæ€»ç»“(ä¼‘æ¯æ¨¡å¼,ç®¡å®¶å·²ä¸ºæ‚¨æ€»ç»“ X ç¯‡æ–‡çŒ®),ç‚¹å‡»è¯¦æƒ…å,å¯å±•ç¤ºæ‰€æœ‰è®ºæ–‡çš„å¤„ç†çŠ¶æ€(å¾…å¤„ç†ã€å¤„ç†ä¸­ã€å·²å®Œæˆã€å¤±è´¥,ä¼˜å…ˆå¤„ç†ä¸­ã€å…¶æ¬¡å¾…å¤„ç†ã€å…¶æ¬¡å¤±è´¥ã€æœ€åå·²å®Œæˆ,è®°å½•å®Œæˆçš„æ—¶é—´)ã€‚
    - **é¡ºåºæ‰§è¡Œ**:åå°ä»»åŠ¡ä¸¥æ ¼æŒ‰ç…§é˜Ÿåˆ—é¡ºåº,æ ¹æ®ç”¨æˆ·è®¾ç½®çš„æ‰¹æ¬¡å¤§å°å’Œé—´éš”æ—¶é—´æ¶ˆè´¹é˜Ÿåˆ—ã€‚

7.  **ç²¾ç»†åŒ–é”™è¯¯å¤„ç†ä¸é‡è¯•**
    - **APIé”™è¯¯æ•è·**:èƒ½æ•è·APIè°ƒç”¨æ—¶çš„å¸¸è§é”™è¯¯(å¦‚ç½‘ç»œè¶…æ—¶ã€è¿æ¥æ‹’ç»ã€APIå¯†é’¥æ— æ•ˆã€429é™æµã€5xxæœåŠ¡å™¨é”™è¯¯ç­‰)ã€‚
    - **PDFè§£æé”™è¯¯**:èƒ½æ•è·PDFæ–‡æœ¬æå–å¤±è´¥(å¦‚æ–‡ä»¶æŸåã€çº¯æ‰«æä»¶)çš„é”™è¯¯ã€‚
    - **é‡è¯•æœºåˆ¶**:
      - åœ¨æ’ä»¶è®¾ç½®ä¸­å…è®¸é…ç½®"æœ€å¤§é‡è¯•æ¬¡æ•°"(ä¾‹å¦‚ 3 æ¬¡)ã€‚
      - å‘ç”Ÿå¯é‡è¯•é”™è¯¯(å¦‚ç½‘ç»œè¶…æ—¶ã€429)æ—¶,ä»»åŠ¡å°†è¿”å›é˜Ÿåˆ—å°¾éƒ¨,ç­‰å¾…ä¸‹æ¬¡è°ƒåº¦æ—¶é‡è¯•ã€‚
    - **å¤±è´¥æ ‡è®°**:è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°åä»å¤±è´¥çš„è®ºæ–‡,çŠ¶æ€æ ‡è®°ä¸º"å¤±è´¥",å¹¶åœ¨çŠ¶æ€åˆ—ä¸­æç¤º,æˆ–åœ¨ç¬”è®°ä¸­è®°å½•é”™è¯¯åŸå› ã€‚

8.  **ç¬”è®°ç®¡ç†ç­–ç•¥**
    - **ç­–ç•¥é…ç½®**:å½“æ’ä»¶æ£€æµ‹åˆ°è¯¥è®ºæ–‡å·²å­˜åœ¨åˆ†æç¬”è®°æ—¶,å…è®¸ç”¨æˆ·åœ¨è®¾ç½®ä¸­é€‰æ‹©æ‰§è¡Œç­–ç•¥:
      - **è·³è¿‡ (é»˜è®¤)**:ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚
      - **è¦†ç›–**:åˆ é™¤æ—§çš„åˆ†æç¬”è®°,è°ƒç”¨APIç”Ÿæˆä¸€ç¯‡å…¨æ–°çš„ç¬”è®°ã€‚
      - **è¿½åŠ **:ä¿ç•™æ—§ç¬”è®°,åœ¨æ—§ç¬”è®°å†…å®¹çš„æœ«å°¾è¿½åŠ æœ¬æ¬¡APIè¿”å›çš„æ–°å†…å®¹ã€‚

9.  **Markdown æ ¼å¼æ”¯æŒ**
    - **æ ¼å¼ä¿å­˜**:å‡å®šå¤§æ¨¡å‹APIè¿”å›çš„æ˜¯Markdownæ ¼å¼æ–‡æœ¬ã€‚
    - **ç›´æ¥å­˜å‚¨**:æ’ä»¶å°†è¿”å›çš„MarkdownåŸæ–‡ç›´æ¥ä¿å­˜åˆ°Zoteroç¬”è®°ä¸­ã€‚Zoteroç¬”è®°ç¼–è¾‘å™¨(6.0.xä»¥ä¸Šç‰ˆæœ¬)æ”¯æŒMarkdownæ¸²æŸ“ã€‚

10. **åç»­è¿½é—®åŠŸèƒ½**
    - **å¯¹è¯ç•Œé¢**:åœ¨AIæ€»ç»“è§†å›¾ä¸­æä¾›"åç»­è¿½é—®"æŒ‰é’®,å…è®¸ç”¨æˆ·ä¸å¤§æ¨¡å‹è¿›è¡Œå¤šè½®å¯¹è¯ã€‚
    - **ä¸Šä¸‹æ–‡ä¿æŒ**:æ¯æ¬¡å¯¹è¯éƒ½ä¼šæºå¸¦è®ºæ–‡å†…å®¹å’Œå®Œæ•´å¯¹è¯å†å²,ç¡®ä¿æ¨¡å‹ç†è§£ä¸Šä¸‹æ–‡ã€‚
    - **é”™è¯¯æ˜¾ç¤º**:å¦‚æœè°ƒç”¨æ¨¡å‹æ—¶å‡ºé”™,é”™è¯¯ä¿¡æ¯ä¼šç›´æ¥æ˜¾ç¤ºåœ¨å¯¹è¯ç•Œé¢ä¸­ã€‚
    - **å¯¹è¯ä¿å­˜**:å¯é€‰æ‹©å°†å¯¹è¯å†å²ä¿å­˜åˆ°è®ºæ–‡çš„AIç®¡å®¶ç¬”è®°ä¸­(éœ€åœ¨è®¾ç½®ä¸­å¼€å¯)ã€‚
    - **åŠ¨æ€è¾“å…¥æ¡†**:è¾“å…¥æ¡†å¯æ ¹æ®å†…å®¹è‡ªåŠ¨è°ƒæ•´å¤§å°,äº¤äº’ä½“éªŒç±»ä¼¼Cherry Studioã€‚

## ğŸ§  LLM Provider æ¶æ„æ·±å…¥

ç³»ç»Ÿé‡‡ç”¨â€œç»Ÿä¸€é—¨é¢ + Provider è‡ªæ³¨å†Œâ€æ¨¡å¼ï¼š

- `LLMClient` (æ–‡ä»¶ `src/modules/llmClient.ts`)ï¼šç»„è£…é€šç”¨ `LLMOptions` åè°ƒç”¨å…·ä½“ Providerï¼›ä¸åŒ…å«ä»»æ„ Vendor ä¸“å±æµå¼è§£æä»£ç ã€‚
- `ProviderRegistry`ï¼šé›†ä¸­ç®¡ç†æ³¨å†Œçš„ Providerï¼Œé€šè¿‡ id æŸ¥æ‰¾ï¼›æ–°å¢ Provider ä¸éœ€ä¿®æ”¹å·²æœ‰æ–‡ä»¶ã€‚
- Provider èƒ½åŠ›æ ‡è®°ï¼šåœ¨ç±»ä¸Šå®šä¹‰ `capabilities`ï¼Œä¾‹å¦‚ `supportsStreaming`ã€`supportsPdfBase64`ï¼Œæµ‹è¯•ä¸ç•Œé¢å¯æ®æ­¤è‡ªé€‚åº”ã€‚

### æ–°å¢ Provider å®Œæ•´æ£€æŸ¥æ¸…å•

> âš ï¸ **é‡è¦**: æ–°å¢ Provider éœ€è¦ä¿®æ”¹å¤šä¸ªæ–‡ä»¶ï¼Œé—æ¼ä»»ä½•ä¸€é¡¹éƒ½å¯èƒ½å¯¼è‡´åŠŸèƒ½å¼‚å¸¸ã€‚è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ¸…å•é€é¡¹å®Œæˆã€‚

#### 1. åˆ›å»º Provider ç±»æ–‡ä»¶

```powershell
# å¯ä½¿ç”¨è„šæœ¬ç”Ÿæˆæ¨¡æ¿ï¼ˆå¦‚æœ‰ï¼‰
node scripts/create-provider.mjs myNewProvider
```

æˆ–æ‰‹åŠ¨åˆ›å»º `src/modules/llmproviders/MyNewProvider.ts`ï¼Œå®ç° `ILlmProvider` æ¥å£ï¼š

- [ ] å®ç° `generateSummary(content, isBase64, prompt, options, onProgress)`
- [ ] å®ç° `chat(pdfContent, isBase64, conversation, options, onProgress)`
- [ ] å®ç° `testConnection(options)`
- [ ] å®ç° `generateMultiFileSummary(pdfFiles, prompt, options, onProgress)`ï¼ˆå¦‚æ”¯æŒå¤šæ–‡ä»¶ï¼‰
- [ ] åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ è‡ªæ³¨å†Œä»£ç ï¼š`ProviderRegistry.register(new MyNewProvider())`

#### 2. å¯¼å‡º Provider

**æ–‡ä»¶**: `src/modules/llmproviders/index.ts`

```typescript
export { default as MyNewProvider } from "./MyNewProvider";
```

#### 3. é…ç½® API Key ç®¡ç†

**æ–‡ä»¶**: `src/modules/apiKeyManager.ts`

- [ ] åœ¨ `ProviderId` ç±»å‹ä¸­æ·»åŠ æ–° ID
- [ ] åœ¨ `PROVIDER_KEY_MAPPINGS` ä¸­æ·»åŠ æ˜ å°„ï¼š

```typescript
mynewprovider: {
  primaryPrefKey: "myNewProviderApiKey",
  extraKeysPrefKey: "myNewProviderApiKeysFallback",
},
```

#### 4. æ·»åŠ é»˜è®¤åå¥½è®¾ç½®

**æ–‡ä»¶**: `addon/prefs.js`

```javascript
pref("__prefsPrefix__.myNewProviderApiUrl", "https://api.example.com");
pref("__prefsPrefix__.myNewProviderApiKey", "");
pref("__prefsPrefix__.myNewProviderModel", "default-model");
```

#### 5. æ·»åŠ ç±»å‹å®šä¹‰

**æ–‡ä»¶**: `typings/prefs.d.ts`

```typescript
"myNewProviderApiUrl": string;
"myNewProviderApiKey": string;
"myNewProviderModel": string;
```

#### 6. æ›´æ–° LLM å®¢æˆ·ç«¯æ˜ å°„

**æ–‡ä»¶**: `src/modules/llmClient.ts`

- [ ] åœ¨ `buildOptions` æ–¹æ³•ä¸­æ·»åŠ  `else if (id === "mynewprovider")` åˆ†æ”¯
- [ ] åœ¨ `mapToKeyManagerId` æ–¹æ³•ä¸­æ·»åŠ æ˜ å°„ï¼š`if (id === "mynewprovider") return "mynewprovider";`

#### 7. æ·»åŠ  UI è®¾ç½®ç•Œé¢ âš ï¸ å®¹æ˜“é—æ¼

**æ–‡ä»¶**: `src/modules/views/settings/ApiSettingsPage.ts`

éœ€è¦ä¿®æ”¹ **5 ä¸ªä½ç½®**ï¼š

1. **Provider ä¸‹æ‹‰é€‰é¡¹** (çº¦ line 76-88)

   ```typescript
   { value: "mynewprovider", label: "My New Provider" },
   ```

2. **æ·»åŠ è®¾ç½®åŒºåŸŸ Section** (çº¦ line 400-480)
   - åˆ›å»º `sectionMyNewProvider` å…ƒç´ 
   - æ·»åŠ  API URLã€API Keyã€Model è¾“å…¥æ¡†
   - æ·»åŠ åˆ° `form.appendChild(sectionMyNewProvider)`

3. **`renderProviderSections` å‡½æ•°** (çº¦ line 490-520)

   ```typescript
   const isMyNewProvider = prov === "mynewprovider";
   (sectionMyNewProvider as HTMLElement).style.display = isMyNewProvider
     ? "block"
     : "none";
   ```

4. **`saveSettings` æ–¹æ³•ä¸­çš„ DOM å…ƒç´ è·å–** (çº¦ line 1750-1820)

   ```typescript
   const mnpUrlEl = this.container.querySelector(
     "#setting-myNewProviderApiUrl",
   ) as HTMLInputElement;
   const mnpKeyEl = this.container.querySelector(
     "#setting-myNewProviderApiKey",
   ) as HTMLInputElement;
   const mnpModelEl = this.container.querySelector(
     "#setting-myNewProviderModel",
   ) as HTMLInputElement;
   ```

5. **`saveSettings` æ–¹æ³•ä¸­çš„ values å¯¹è±¡ã€éªŒè¯å’Œä¿å­˜**
   - [ ] åœ¨ `values` å¯¹è±¡ä¸­æ·»åŠ å±æ€§
   - [ ] æ·»åŠ  `else if (provider === "mynewprovider")` éªŒè¯åˆ†æ”¯
   - [ ] æ·»åŠ  `setPref` ä¿å­˜è°ƒç”¨

#### 8. æ›´æ–°æ–‡æ¡£

- [ ] `README.md` - æ”¯æŒå¹³å°è¡¨æ ¼
- [ ] `doc/DevelopmentGuide.md` - ç¯å¢ƒå˜é‡ç¤ºä¾‹
- [ ] `docs/api-configuration.md` - é…ç½®æŒ‡å—

### é€‰é¡¹ä¼ é€’çº¦å®š (LLMOptions)

| å­—æ®µ           | è¯´æ˜              | æ˜¯å¦å¿…å¡«         |
| -------------- | ----------------- | ---------------- |
| provider       | Provider id       | æ˜¯               |
| temperature    | é‡‡æ ·æ¸©åº¦          | å¦               |
| stream         | è¯·æ±‚æµå¼è¾“å‡º      | å¦               |
| maxTokens      | æœ€å¤§è¾“å‡ºé•¿åº¦      | å¦               |
| pdfMode        | `base64` / `text` | æ˜¯ï¼ˆç”±åå¥½å†³å®šï¼‰ |
| promptTemplate | æç¤ºè¯æ¨¡æ¿å      | æ˜¯               |
| timeoutMs      | è¯·æ±‚è¶…æ—¶æ—¶é—´      | å¦               |

Provider è‹¥ä¸æ”¯æŒæŸå­—æ®µï¼ˆä¾‹å¦‚ä¸æ”¯æŒ `temperature`ï¼‰ï¼Œåº”å¿½ç•¥è€ŒéæŠ¥é”™ï¼Œä¿è¯å…¼å®¹æ€§ã€‚

## ğŸ” ç¯å¢ƒå˜é‡æ³¨å…¥ä¸æµ‹è¯•æœºåˆ¶

æµ‹è¯•å‰ç½®è„šæœ¬ `scripts/gen-env-setup.mjs` ä¼šè¯»å– `.env` å¹¶ç”Ÿæˆ `test/00.env-setup.test.ts` å°†é”®å€¼å†™å…¥ Zotero åå¥½ã€‚å…³é”®å˜é‡ç¤ºä¾‹ï¼š

```
ACTIVE_LLM_PROVIDER=openai
OPENAI_API_KEY=sk-xxxxx
OPENAI_BASE_URL=https://api.openai.com/v1
GEMINI_API_KEY=ya29.xxxxx
GEMINI_BASE_URL=https://generativelanguage.googleapis.com
ANTHROPIC_API_KEY=sk-ant-xxxxx
ANTHROPIC_BASE_URL=https://api.anthropic.com
VOLCANOARK_API_KEY=ark-xxxxx
VOLCANOARK_BASE_URL=https://ark.cn-beijing.volces.com/api/v3/chat/completions
TEMPERATURE=0.7
STREAM=true
MAX_TOKENS=4096
PDF_MODE=base64
```

### ACTIVE_LLM_PROVIDER ä½œç”¨

- ä»…å¯¹è¯¥ Provider æ‰§è¡Œè€—æ—¶çš„æ‘˜è¦/å¤šæ¨¡æ€æµ‹è¯•ã€‚
- å…¶å®ƒ Provider æ ‡è®° `pending`ï¼Œå¹¶è®°å½•åŸå› ï¼ˆinactive æˆ–ç¼ºå°‘å¯†é’¥ï¼‰ã€‚
- é¿å… CI ä¸­å‡ºç°å¤§é‡ç”±äºæœªé…ç½®è€Œå¤±è´¥çš„ç”¨ä¾‹ã€‚

### Base64 PDF æµ‹è¯•è¯´æ˜

å½“ `PDF_MODE=base64` ä¸” Provider å£°æ˜ `supportsPdfBase64`ï¼š

1. æµ‹è¯•æ„é€ ï¼ˆæˆ–è¯»å–ï¼‰ä¸€ä¸ªå°å‹ PDFï¼ˆæœªæ¥å¯æ›¿æ¢ä¸ºå›ºå®š fixtureï¼‰ã€‚
2. å°†å…¶ Base64 å†™å…¥è¯·æ±‚æ•°æ®ç»“æ„ä¸­ï¼ˆä¸åŒæœåŠ¡å­—æ®µå¯èƒ½ä¸åŒï¼‰ã€‚
3. éªŒè¯è¿”å›æ˜¯å¦å«æœ‰ç»“æ„åŒ–æ‘˜è¦ï¼ˆè‡³å°‘åŒ…å«å‡ ä¸ª Markdown æ ‡é¢˜ï¼‰ã€‚
4. ä¸æ”¯æŒæ—¶ç›´æ¥ `this.skip()`ã€‚

## ğŸ§ª æµ‹è¯•åˆ†å±‚ç­–ç•¥

| å±‚çº§               | å†…å®¹                            | ç›®çš„                                |
| ------------------ | ------------------------------- | ----------------------------------- |
| è¿æ¥æµ‹è¯•           | `testConnection`                | æ ¡éªŒå¯†é’¥/ç«¯ç‚¹æ­£ç¡®æ€§ä¸é”™è¯¯æç¤ºå¯è¯»æ€§ |
| æ–‡æœ¬æ‘˜è¦ï¼ˆæµå¼ï¼‰   | `generateSummary(stream=true)`  | æ ¡éªŒåˆ†å—æ‹¼æ¥ä¸æœ€ç»ˆå®Œæ•´æ€§            |
| æ–‡æœ¬æ‘˜è¦ï¼ˆéæµå¼ï¼‰ | `generateSummary(stream=false)` | éªŒè¯é™çº§è·¯å¾„é€»è¾‘                    |
| Base64 PDF         | `pdfMode=base64`                | å¤šæ¨¡æ€èƒ½åŠ›éªŒè¯/è‡ªåŠ¨è·³è¿‡             |

## ğŸ”„ é”™è¯¯ä¸é‡è¯•ç­–ç•¥ï¼ˆæ‰©å±•ï¼‰

å»ºè®® Provider å†…éƒ¨ï¼š

- è¯†åˆ«é€Ÿç‡é™åˆ¶ (`429`) â†’ æŠ›å‡ºå¸¦ `code='rate_limit'` çš„é”™è¯¯ï¼Œç”±é˜Ÿåˆ—å±‚å†³å®šæ˜¯å¦é‡è¯•ã€‚
- è¯†åˆ«ç½‘ç»œè¶…æ—¶ â†’ æŠ›å‡º `code='timeout'`ã€‚
- JSON è§£æå¤±è´¥ â†’ é™„åŠ åŸå§‹ç‰‡æ®µä¾¿äºè°ƒè¯•ã€‚

## ğŸ§ª æœ¬åœ°è°ƒè¯•å°è´´å£«

- ä»…è°ƒè¯•æŸ Providerï¼šç›´æ¥æ”¹ `.env` çš„ `ACTIVE_LLM_PROVIDER`ã€‚
- ä¸´æ—¶ç¦ç”¨æµå¼ï¼šè®¾ç½® `STREAM=false`ã€‚
- å¿«é€ŸéªŒè¯ token é™åˆ¶ï¼šå°† `MAX_TOKENS` è°ƒä½ï¼Œæ¯”å¦‚ 256ï¼Œè§‚å¯Ÿæˆªæ–­è¡Œä¸ºã€‚

## ğŸ“ æç¤ºè¯æ¨¡æ¿æ‰©å±•

æ–°å¢æ¨¡æ¿æ­¥éª¤ï¼š

1. åœ¨ `src/utils/prompts.ts` ä¸­æ·»åŠ æ¨¡æ¿ç»“æ„ã€‚
2. åœ¨åå¥½/è®¾ç½®é¡µé¢å¢åŠ ä¸‹æ‹‰é€‰é¡¹ã€‚
3. ï¼ˆå¯é€‰ï¼‰åœ¨æµ‹è¯•ä¸­æ·»åŠ ä¸€ä¸ªä½¿ç”¨æ–°æ¨¡æ¿çš„ smoke caseã€‚

## âœ… è´¨é‡é—¨æ§å»ºè®®

- æ„å»ºï¼š`npm run build` åº”æ— ç±»å‹é”™è¯¯ã€‚
- æµ‹è¯•ï¼šæ´»åŠ¨ Provider å…¨éƒ¨é€šè¿‡ï¼Œéæ´»åŠ¨ä»… pendingã€‚
- Lintï¼š`npm run lint:check` é€šè¿‡ã€‚
- åç»­å¯å¼•å…¥ï¼šProvider å¥‘çº¦çš„ API å˜æ›´ diff æ£€æµ‹ï¼ˆåˆ©ç”¨ TypeScript `dts` è¾“å‡ºï¼‰ã€‚
